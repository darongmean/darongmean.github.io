<!DOCTYPE html>
<html
  lang="en-us"
  prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"
>
  <head>
    <meta charset="utf-8" />

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />
<meta name="viewport" content="width=device-width, initial-scale=1" />


<link rel="apple-touch-icon" sizes="180x180" href="https://darongmean.com/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://darongmean.com/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://darongmean.com/favicon-16x16.png">
<link rel="manifest" href="https://darongmean.com/site.webmanifest">
<link rel="mask-icon" href="https://darongmean.com/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">



<meta name="keywords" content="boot-clj,,
docker,,
nrepl,,
cljs-repl,
">

<meta property="og:title" content="How to use boot-clj and nREPL with Docker" />
<meta property="og:description" content="There&rsquo;s a great post about using clojure with docker. I followed the post with a twist. I used boot-alpine image[1] and docker-compose instead of Vagrant.
Here&rsquo;s the final configuration that worked.
# file docker-compose.yml version: &#39;2&#39; services: bootclj: command: boot dev image: clojure:boot-alpine ports: - 9007:9007 - 9009:9009 - 9011:9011 - 3000:3000 volumes_from: - m2 working_dir: /opt/src m2: command: echo &#34;m2 container ready!&#34; image: alpine volumes: - /root/.m2 - ./:/opt/src ; file build." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://darongmean.com/post/how-to-use-boot-clj-and-nrepl-with-docker/" /><meta property="og:image" content="https://darongmean.com/images/avatar@2x.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-04-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-04-20T00:00:00+00:00" />


<meta property="og:site_name" content="Darong Mean" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:image" content="https://darongmean.com/images/avatar@2x.png"/>

<meta name="twitter:title" content="How to use boot-clj and nREPL with Docker"/>
<meta name="twitter:description" content="There&rsquo;s a great post about using clojure with docker. I followed the post with a twist. I used boot-alpine image[1] and docker-compose instead of Vagrant.
Here&rsquo;s the final configuration that worked.
# file docker-compose.yml version: &#39;2&#39; services: bootclj: command: boot dev image: clojure:boot-alpine ports: - 9007:9007 - 9009:9009 - 9011:9011 - 3000:3000 volumes_from: - m2 working_dir: /opt/src m2: command: echo &#34;m2 container ready!&#34; image: alpine volumes: - /root/.m2 - ./:/opt/src ; file build."/>


<meta itemprop="name" content="How to use boot-clj and nREPL with Docker">
<meta itemprop="description" content="There&rsquo;s a great post about using clojure with docker. I followed the post with a twist. I used boot-alpine image[1] and docker-compose instead of Vagrant.
Here&rsquo;s the final configuration that worked.
# file docker-compose.yml version: &#39;2&#39; services: bootclj: command: boot dev image: clojure:boot-alpine ports: - 9007:9007 - 9009:9009 - 9011:9011 - 3000:3000 volumes_from: - m2 working_dir: /opt/src m2: command: echo &#34;m2 container ready!&#34; image: alpine volumes: - /root/.m2 - ./:/opt/src ; file build."><meta itemprop="datePublished" content="2017-04-20T00:00:00+00:00" />
<meta itemprop="dateModified" content="2017-04-20T00:00:00+00:00" />
<meta itemprop="wordCount" content="291"><meta itemprop="image" content="https://darongmean.com/images/avatar@2x.png"/>
<meta itemprop="keywords" content="" />


    <title>How to use boot-clj and nREPL with Docker || Darong Mean</title>
    <link rel="canonical" href="https://darongmean.com/post/how-to-use-boot-clj-and-nrepl-with-docker/" />

    

    <link rel="stylesheet" href="/css/reboot.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/syntax.css" />
<script type="text/javascript" src="/js/main.js"></script>

<link href="https://fonts.googleapis.com/css?family=Lora&display=swap" rel="stylesheet">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    
<script async src="https://cdn.panelbear.com/analytics.js?site=5Ms17CYbCwv"></script>
<script>
    window.panelbear = window.panelbear || function() { (window.panelbear.q = window.panelbear.q || []).push(arguments); };
    panelbear('config', { site: '5Ms17CYbCwv' });
</script>
  </head>
  <body
  class=" look-sheet-bkg"
  lang="en-us">
  <div class="nav-bkg drop-shadow">
    <nav class="content-container pagewide-bar-padding">
      <span class="divider">/ </span>
      <a href="/" >Darong Mean</a>
      <span class="divider">/ </span>
          <a href="/posts/">Posts</a>
      <ul class="list-unstyled right-links">

          <li>
            <a href="/posts/">
              <span class="post-title">archive</span>
            </a>
          </li>

          <li>
            <a href="/about/">
              <span class="post-title">about</span>
            </a>
          </li>

</ul>

    </nav>
  </div>
  <article
    id="main"
    class="content-container look-sheet article-pad-v "
    itemscope
    itemtype="https://schema.org/Article" >
  <meta itemprop="author" content="Darong Mean" />
  <meta itemprop="publisher" content="Darong Mean" />
  <meta itemprop="image" content="https://darongmean.com/images/avatar@2x.png" />
  <h1 itemprop="name" id="title">How to use boot-clj and nREPL with Docker</h1>
  <meta itemprop="headline" content="How to use boot-clj and nREPL with Docker" />
  
  
    
      <div class="post-date"><span itemprop="datePublished">April 20, 2017</span></div>
      <meta itemprop="dateModified" content="April 20, 2017"/>
    
  
  
  <div itemprop="articleBody" id="content" class="article-body margin-top-2em">
    <p>There&rsquo;s a great post about <a href="http://blog.dominic.io/vagrant-docker-and-clojure/">using clojure with docker.</a> I followed the post with a twist. I used <code>boot-alpine</code> image[<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>] and <code>docker-compose</code> instead of <code>Vagrant</code>.</p>
<p>Here&rsquo;s the final configuration that worked.</p>
<pre tabindex="0"><code># file docker-compose.yml
version: &#39;2&#39;
services:
  bootclj:
    command: boot dev
    image: clojure:boot-alpine
    ports:
      - 9007:9007
      - 9009:9009
      - 9011:9011
      - 3000:3000
    volumes_from:
      - m2
    working_dir: /opt/src
  m2:
    command: echo &#34;m2 container ready!&#34;
    image: alpine
    volumes:
      - /root/.m2
      - ./:/opt/src
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-clojure" data-lang="clojure"><span style="display:flex;"><span><span style="color:#75715e">; file build.boot</span>
</span></span><span style="display:flex;"><span>(<span style="color:#a6e22e">deftask</span> development []
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">task-options!</span>
</span></span><span style="display:flex;"><span>    cljs {<span style="color:#e6db74">:optimizations</span>    <span style="color:#e6db74">:none</span>
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">:source-map</span>       true
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">:compiler-options</span> {<span style="color:#e6db74">:devcards</span> true}}
</span></span><span style="display:flex;"><span>    start-repl {<span style="color:#e6db74">:ip</span> <span style="color:#e6db74">&#34;0.0.0.0&#34;</span> <span style="color:#e6db74">:port</span> <span style="color:#ae81ff">9007</span>}
</span></span><span style="display:flex;"><span>    cljs-repl {<span style="color:#e6db74">:nrepl-opts</span> {<span style="color:#e6db74">:bind</span> <span style="color:#e6db74">&#34;0.0.0.0&#34;</span> <span style="color:#e6db74">:port</span> <span style="color:#ae81ff">9009</span>}}
</span></span><span style="display:flex;"><span>    reload {<span style="color:#e6db74">:on-jsload</span> <span style="color:#e6db74">&#39;timer.app/reload</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">:port</span>      <span style="color:#ae81ff">9011</span>}
</span></span><span style="display:flex;"><span>    serve {<span style="color:#e6db74">:port</span> <span style="color:#ae81ff">3000</span>})
</span></span><span style="display:flex;"><span>  identity)
</span></span></code></pre></div><h2 id="challenges-i-faced">Challenges I faced</h2>
<p>Being a beginner in both boot-clj and Docker, I bumped into the following issues.</p>
<h3 id="i-couldnt-connect-to-nrepl-running-in-docker2">I couldn&rsquo;t connect to nREPL running in Docker[<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>].</h3>
<p>I got the following error when I used Cursive remote repl to connect.</p>
<pre tabindex="0"><code>Connecting to remote nREPL server...
Error connecting to localhost:9009 - class java.net.ConnectException: Connection refused
</code></pre><p>By going through document and looking at the source code[<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>], I found out that I need to run two tasks to have browser repl working. The task <code>cljs-repl</code> starts a repl server and the task <code>start-repl</code> connects the repl server to browser.</p>
<p>The repl server listens to loopback interface[<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>] by default. I used the <code>bind</code> nrepl option to override this setting like the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-clojure" data-lang="clojure"><span style="display:flex;"><span>cljs-repl {<span style="color:#e6db74">:nrepl-opts</span> {<span style="color:#e6db74">:bind</span> <span style="color:#e6db74">&#34;0.0.0.0&#34;</span> <span style="color:#e6db74">:port</span> <span style="color:#ae81ff">9009</span>}}
</span></span></code></pre></div><h3 id="boot-downloaded-dependencies-everytime-i-rebuilt-docker-images">Boot downloaded dependencies everytime I rebuilt docker images.</h3>
<p>I used data container to store <code>.m2</code> repositories. I just use the following command to rebuild and start the image:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker-compose stop bootclj 
</span></span><span style="display:flex;"><span>docker-compose rm bootclj
</span></span><span style="display:flex;"><span>docker-compose create bootclj
</span></span><span style="display:flex;"><span>docker-compose start bootclj
</span></span></code></pre></div><hr>
<p>Footnote:</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>1: <a href="https://hub.docker.com/_/clojure/">link to official Docker image for Clojure</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>2: <code>adzerk/boot-cljs-repl</code> version <code>0.3.3</code> is used in this post&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>3: <a href="https://github.com/adzerk-oss/boot-cljs-repl/blob/master/src/adzerk/boot_cljs_repl.clj#L204">boot_cljs_repl.clj</a> and <a href="https://github.com/boot-clj/boot/blob/2.6.0/boot/core/src/boot/task/built_in.clj#L371">built_in.clj</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>4: <a href="https://clojure.org/reference/repl_and_main#_launching_a_socket_server">https://clojure.org/reference/repl_and_main#_launching_a_socket_server</a>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

  </div>
</article>

  <style type="text/css">
	.content-container-narrow-pad {
		margin-bottom: 5em;
	}
</style>

  
    <div class="nav-bkg-50 content-container-narrow-pad bottom-links text-0p75 drop-shadow">
      <nav class="flex-row">
      
      <a href="https://darongmean.com/post/challenges-java-flame-graphs-introduction/" class="flex-row v-center no-underline"  style="max-width:45%;">
        <span class="text-1p5">←</span>&nbsp;<span class="re-underline">Previous: Challenges - Java Flame Graphs Introduction: Fire For Everyone!</span>
      </a>
      
      
        <a href="https://darongmean.com/post/sum-type-or-union-type/" class="flex-row v-center no-underline" style="max-width: 45%;">
        <span class="re-underline">Next: Sum Type/Union Type</span>&nbsp;<span class="text-1p5">→</span>
        </a>
      
      </nav>
    </div>
  

  <div class="content-container vertical-margins">
    <div class="flex-row flex-center">
      <footer class="footer">
      <span>© 2016-2022 <a href="/">Darong Mean</a></span>
      <span>Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &amp;
        <a href="https://github.com/capnfabs/paperesque" rel="noopener" target="_blank">paperesque</a>
      </span>
      </footer>
    </div>
  </div>
  </body>
  <script type="module" src="https://cdn.skypack.dev/pin/@hotwired/turbo@v7.2.4-ZifPufG8LWXS2LFpHP7B/mode=imports,min/optimized/@hotwired/turbo.js"></script>
</html>
